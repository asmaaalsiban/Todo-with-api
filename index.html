<!-- @format -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- tailwindcss cdn -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <title>Todo Task-middad-21</title>
  </head>
  <body>
    <!-- start html here -->
    <div class="container mx-auto bg-gray-300 w-full min-h-screen">
      <!-- start header here -->
      <header class="p-4 border-b-3 border-purple-500">
        <div class="flex flex-row justify-between items-center italic">
          <h1 class="text-xl font-bold text-gray-700">Todo Task</h1>
          <h1 class="text-xl font-bold text-gray-700">Asmaa Alsiban</h1>
        </div>
      </header>
      <!-- end header here -->
      <!-- start tasks here -->
      <div
        class="bg-gray-400 w-80 lg:w-100 md:100 p-5 px-2 rounded-md flex justify-center items-center mt-10 position-relative mx-auto">
        <div id="tasksContainer">
          <!-- Tasks -->
          <!-- start  task -->

          <!-- end  task -->
        </div>
      </div>
      <!-- end tasks here -->
      <!-- start add Task button here -->
      <div
        class="flex justify-center items-center mt-2 position-relative mx-auto">
        <div>
          <input
            type="text"
            class="bg-white d-block px-4 py-2 rounded-md mt-5 focus:outline-purple-500 mx-auto lg:w-70"
            placeholder="Write a task"
            id="taskInput"
            value="" />
          <button
            id="addTaskBtn"
            class="bg-purple-500 text-white px-4 py-2 rounded-md mt-5 hover:bg-purple-700 mx-auto d-block cursor-pointer italic">
            Add Task
          </button>
        </div>
      </div>
      <!-- end add Task button here -->
    </div>

    <!-- end html here -->

    <!-- start styling here -->
    <style>
      #tasksContainer {
        height: 300px;
        overflow-y: scroll;
        overflow-x: hidden;
        scrollbar-width: thin;
        scrollbar-color: #a78bfa #f3f4f6;
      }
      p {
        text-decoration: th;
      }
      /* stlying with tailwindcss */
    </style>
    <!-- end styling here -->
    <!-- start scripting here -->
    <script>
      // get todos from api

      fetch("https://dummyjson.com/todos")
        .then((res) => res.json())
        .then((data) => {
          var todos = data.todos;
          // localstorage
          localStorage.setItem("todos", JSON.stringify(todos));
          getTodos();
        });
      // getting todos from localstorage
      function getTodos() {
        document.getElementById(
          "tasksContainer"
        ).innerHTML = `  <h2 class="text-2xl italic text-center">Todos</h2>`;
        let todosFromStorage = JSON.parse(localStorage.getItem("todos"));

        let content;
        for (let todo of todosFromStorage) {
          let title = todo.todo;
          content = `<div
            class="bg-white   lg:w-87 h-12 mt-5 mx-2 rounded-lg flex flex-row justify-between items-center p-4">
            <div class="flex flex-row gap-2">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="size-6 hover:text-red-500 hover:cursor-pointer" onclick="handleDelete(${todo.id})">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5m6 4.125 2.25 2.25m0 0 2.25 2.25M12 13.875l2.25-2.25M12 13.875l-2.25 2.25M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z" />
              </svg>
              <p id=${todo.id} class="">${title}</p>
            </div>
            <input type="checkbox" onchange="handelChange(${todo.id})"/>
          </div>`;
          document.getElementById("tasksContainer").innerHTML += content;
        }
      }
      // adding todo
      function addTodo() {
        let taskInput = document.getElementById("taskInput");
        let btn = document.getElementById("addTaskBtn");
        btn.addEventListener("click", () => {
           let taskInputValue = "";
          if (taskInput.value != "") {
            taskInputValue = taskInput.value;
          } else {
            alert("Please write a todo task");
            return;
          }
          ///api
          fetch("https://dummyjson.com/todos/add", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              todo: taskInputValue,
              completed: false,
              userId: 5,
            }),
          })
            .then((res) => res.json())
            .then((data) => {
              let todosFromStorage = JSON.parse(localStorage.getItem("todos"));
              todosFromStorage.push(data);
              console.log(todosFromStorage);
              localStorage.setItem("todos", JSON.stringify(todosFromStorage));
              getTodos();
              taskInput.value = "";
            });
        });
      }
      //change to completed or uncompleted
      function handelChange(id) {
        let textElement = document.getElementById(id);
        if (textElement.style.textDecoration === "line-through") {
          textElement.style.textDecoration = "none";
        } else {
          textElement.style.textDecoration = "line-through";
        }
      }
      // delete todo
      function handleDelete(id) {
        // without api
        let todosFromStorage = JSON.parse(localStorage.getItem("todos"));
        for (let i = 0; i < todosFromStorage.length; i++) {
          if (todosFromStorage[i].id === id) {
            console.log("deleted", todosFromStorage[i]);
            todosFromStorage.splice(i, 1);
            localStorage.setItem("todos", JSON.stringify(todosFromStorage));
            getTodos();
            break;
          }
        }
        // fetch(`https://dummyjson.com/todos/${id}`, {
        //   method: "DELETE",
        // })
        //   .then((res) => res.json())
        //   .then((data) => {
        //     let todosFromStorage = JSON.parse(localStorage.getItem("todos"));
        //     for (let i = 0; i < todosFromStorage.length; i++) {
        //       if (todosFromStorage[i].id === data.id) {
        //         todosFromStorage.splice(i, 1);
        //         localStorage.setItem("todos", JSON.stringify(todosFromStorage));
        //         getTodos();
        //         break;
        //       }
        //     }
        //   });
      }
      addTodo();
    </script>
    <!-- end scripting here -->
  </body>
</html>
